<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.shape.SVGPath?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.Cursor?>

<ScrollPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.smarttask.client.view.controller.ProfileController"
            styleClass="profile-scroll"
            stylesheets="@../css/profile.css"
            fitToWidth="true">

    <VBox styleClass="profile-container" spacing="25">
        <padding>
            <Insets top="30" right="30" bottom="30" left="30"/>
        </padding>

        <HBox styleClass="profile-page-header" alignment="CENTER_LEFT">
            <Text text="Mon Profil" styleClass="profile-page-title"/>
        </HBox>

        <VBox styleClass="profile-card" spacing="20">
            <padding>
                <Insets top="30" right="30" bottom="30" left="30"/>
            </padding>

            <HBox styleClass="profile-header" alignment="CENTER_LEFT" spacing="20">
                <StackPane styleClass="avatar-wrapper">
                    <StackPane styleClass="avatar-large">
                        <Text fx:id="avatarText" text="?" styleClass="avatar-text"/>
                    </StackPane>
                    <Button styleClass="avatar-edit-btn" onAction="#handleEditAvatar" StackPane.alignment="BOTTOM_RIGHT">
                        <graphic>
                            <SVGPath content="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" scaleX="0.7" scaleY="0.7" fill="white"/>
                        </graphic>
                        <tooltip><Tooltip text="Modifier la photo"/></tooltip>
                    </Button>
                </StackPane>

                <VBox spacing="5" alignment="CENTER_LEFT">
                    <Label fx:id="usernameLabel" text="Chargement..." styleClass="profile-username"/>
                    <Label fx:id="roleLabel" text="Membre" styleClass="profile-role"/>
                </VBox>
            </HBox>

            <Separator/>

            <GridPane vgap="20" hgap="20" styleClass="profile-grid">
                <columnConstraints>
                    <ColumnConstraints minWidth="150" prefWidth="180"/>
                    <ColumnConstraints hgrow="ALWAYS"/>
                </columnConstraints>

                <Label text="Nom d'utilisateur" styleClass="field-label" GridPane.rowIndex="0" labelFor="$usernameField"/>
                <TextField fx:id="usernameField" styleClass="form-field" GridPane.columnIndex="1" GridPane.rowIndex="0" editable="false" disable="true"/>

                <Label text="PrÃ©nom" styleClass="field-label" GridPane.rowIndex="1" labelFor="$firstNameField"/>
                <TextField fx:id="firstNameField" styleClass="form-field" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                <Label text="Nom" styleClass="field-label" GridPane.rowIndex="2" labelFor="$lastNameField"/>
                <TextField fx:id="lastNameField" styleClass="form-field" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                <Label text="Email" styleClass="field-label" GridPane.rowIndex="3" labelFor="$emailField"/>
                <TextField fx:id="emailField" styleClass="form-field" GridPane.columnIndex="1" GridPane.rowIndex="3"/>
            </GridPane>

            <HBox alignment="CENTER_LEFT" spacing="15">
                <Button text="Sauvegarder les modifications" styleClass="primary-btn" onAction="#handleSaveProfile"/>
                <Label fx:id="profileStatusLabel" visible="false" styleClass="status-label"/>
            </HBox>
        </VBox>

        <VBox styleClass="profile-card password-card" spacing="20">
            <padding>
                <Insets top="30" right="30" bottom="30" left="30"/>
            </padding>

            <HBox alignment="CENTER_LEFT" spacing="10">
                <Text text="ðŸ”’" styleClass="section-icon"/>
                <Label text="SÃ©curitÃ©" styleClass="section-header"/>
            </HBox>

            <Label text="VÃ©rifiez votre mot de passe actuel avant d'en changer." styleClass="section-subtitle"/>

            <Separator/>

            <VBox spacing="15" styleClass="password-step">
                <Label text="1. VÃ©rification d'identitÃ©" styleClass="step-label"/>
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <StackPane HBox.hgrow="ALWAYS">
                        <TextField fx:id="currentPasswordText" styleClass="form-field, password-input" promptText="Mot de passe actuel" visible="false" managed="false"/>
                        <PasswordField fx:id="currentPasswordField" styleClass="form-field, password-input" promptText="Mot de passe actuel"/>

                        <Button fx:id="toggleCurrentBtn" styleClass="icon-btn-eye" StackPane.alignment="CENTER_RIGHT" onAction="#toggleCurrentPassword">
                            <graphic><SVGPath content="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" scaleX="0.8" scaleY="0.8" styleClass="eye-icon"/></graphic>
                            <padding><Insets right="10"/></padding>
                        </Button>
                    </StackPane>

                    <Button fx:id="verifyPasswordButton" text="VÃ©rifier" styleClass="secondary-btn" onAction="#handleVerifyPassword"/>
                </HBox>
                <Label fx:id="verifyStatusLabel" visible="false" styleClass="status-label"/>
            </VBox>

            <Separator/>

            <VBox fx:id="newPasswordSection" spacing="15" styleClass="password-step" disable="true" opacity="0.5">
                <Label text="2. DÃ©finir le nouveau mot de passe" styleClass="step-label"/>

                <GridPane vgap="15" hgap="20">
                    <columnConstraints>
                        <ColumnConstraints minWidth="150" prefWidth="180"/>
                        <ColumnConstraints hgrow="ALWAYS"/>
                    </columnConstraints>

                    <Label text="Nouveau mot de passe" styleClass="field-label" GridPane.rowIndex="0"/>
                    <StackPane GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <TextField fx:id="newPasswordText" styleClass="form-field, password-input" visible="false" managed="false" promptText="6 caractÃ¨res min."/>
                        <PasswordField fx:id="newPasswordField" styleClass="form-field, password-input" promptText="6 caractÃ¨res min."/>

                        <Button fx:id="toggleNewBtn" styleClass="icon-btn-eye" StackPane.alignment="CENTER_RIGHT" onAction="#toggleNewPassword">
                            <graphic><SVGPath content="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" scaleX="0.8" scaleY="0.8" styleClass="eye-icon"/></graphic>
                            <padding><Insets right="10"/></padding>
                        </Button>
                    </StackPane>

                    <Label text="Confirmer" styleClass="field-label" GridPane.rowIndex="1"/>
                    <StackPane GridPane.columnIndex="1" GridPane.rowIndex="1">
                        <PasswordField fx:id="confirmPasswordField" styleClass="form-field, password-input" promptText="RÃ©pÃ©tez le mot de passe"/>
                    </StackPane>
                </GridPane>

                <HBox alignment="CENTER_LEFT" spacing="15">
                    <Button fx:id="changePasswordButton" text="Modifier le mot de passe" styleClass="primary-btn" onAction="#handleChangePassword"/>
                    <Label fx:id="passwordStatusLabel" visible="false" styleClass="status-label"/>
                </HBox>
            </VBox>
        </VBox>
    </VBox>
</ScrollPane>