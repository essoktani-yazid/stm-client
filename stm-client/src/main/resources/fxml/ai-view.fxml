<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.shape.SVGPath?>
<?import javafx.scene.text.TextFlow?>

<StackPane fx:id="aiRoot" styleClass="ai-root" stylesheets="@../css/ai-style.css"
           xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.smarttask.client.view.controller.AIController">

    <Pane fx:id="backgroundShapes" pickOnBounds="false">
        <Circle fx:id="blob1" fill="#e0c6f7" radius="180" layoutX="200" layoutY="200" styleClass="blob-shape"/>
        <Circle fx:id="blob2" fill="#c4dbfa" radius="140" layoutX="900" layoutY="150" styleClass="blob-shape"/>
        <Circle fx:id="blob3" fill="#fce7f3" radius="120" layoutX="500" layoutY="600" styleClass="blob-shape"/>
    </Pane>

    <VBox alignment="TOP_CENTER" maxWidth="900" spacing="0" pickOnBounds="false">
        <padding><Insets top="50" left="20" right="20" bottom="20"/></padding>

        <VBox fx:id="homeContainer" alignment="CENTER" spacing="40" VBox.vgrow="ALWAYS">
            <Label fx:id="typingTitle" styleClass="creative-title" text="" />
            <Region prefHeight="80" />
            
            <HBox fx:id="cardsContainer" alignment="CENTER" spacing="20" maxWidth="850">
                <Button styleClass="card-glass" onAction="#handleSuggestion" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                    <graphic>
                        <VBox spacing="5" alignment="TOP_LEFT">
                            <StackPane styleClass="card-icon-container">
                                <SVGPath content="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" styleClass="card-svg-path, icon-rocket"/>
                            </StackPane>
                            <Label text="Create Task" styleClass="card-title"/>
                            <Label text="New task with details" styleClass="card-desc"/>
                        </VBox>
                    </graphic>
                    <userData>Create a new task with title 'New Project' and high priority.</userData>
                </Button>

                <Button styleClass="card-glass" onAction="#handleSuggestion" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                    <graphic>
                        <VBox spacing="5" alignment="TOP_LEFT">
                            <StackPane styleClass="card-icon-container">
                                <SVGPath content="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" styleClass="card-svg-path, icon-bolt"/>
                            </StackPane>
                            <Label text="Read Tasks" styleClass="card-title"/>
                            <Label text="Show my TODO tasks" styleClass="card-desc"/>
                        </VBox>
                    </graphic>
                    <userData>Show all my TODO tasks with high priority.</userData>
                </Button>

                <Button styleClass="card-glass" onAction="#handleSuggestion" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                    <graphic>
                        <VBox spacing="5" alignment="TOP_LEFT">
                            <StackPane styleClass="card-icon-container">
                                <SVGPath content="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" styleClass="card-svg-path, icon-megaphone"/>
                            </StackPane>
                            <Label text="Update Task" styleClass="card-title"/>
                            <Label text="Modify task details" styleClass="card-desc"/>
                        </VBox>
                    </graphic>
                    <userData>Update the task 'New Project' to completed status.</userData>
                </Button>

                <Button styleClass="card-glass" onAction="#handleSuggestion" HBox.hgrow="ALWAYS" maxWidth="Infinity">
                    <graphic>
                        <VBox spacing="5" alignment="TOP_LEFT">
                            <StackPane styleClass="card-icon-container">
                                <SVGPath content="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" styleClass="card-svg-path, icon-brain"/>
                            </StackPane>
                            <Label text="Delete Task" styleClass="card-title"/>
                            <Label text="Remove a task" styleClass="card-desc"/>
                        </VBox>
                    </graphic>
                    <userData>Delete the task with title 'New Project'.</userData>
                </Button>
            </HBox>
        </VBox>

        <VBox fx:id="resultContainer" visible="false" managed="false" spacing="15" alignment="TOP_CENTER" maxWidth="850" VBox.vgrow="ALWAYS">
            
            <HBox alignment="CENTER_LEFT" styleClass="user-question-container">
                <Label fx:id="userQuestionLabel" wrapText="true" styleClass="user-question-bubble"/>
            </HBox>
            
            <VBox styleClass="response-card" VBox.vgrow="ALWAYS" minHeight="200">
                
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="SmartTask AI" styleClass="response-header"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="Copy" styleClass="btn-action-small"/>
                </HBox>
                
                <Separator styleClass="response-separator"/>
                
                <HBox fx:id="statusContainer" visible="false" managed="false" alignment="CENTER_LEFT" spacing="8" styleClass="status-pill" maxWidth="350">
                    <SVGPath fx:id="statusIcon" content="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z" 
                             styleClass="icon-spinner" />
                    <Label fx:id="statusLabel" text="Thinking..." styleClass="status-label"/>
                </HBox>

                <ScrollPane fx:id="responseScroll" fitToWidth="true" styleClass="response-scroll" VBox.vgrow="ALWAYS">
                    <TextFlow fx:id="aiResponseFlow" styleClass="response-text-flow" lineSpacing="6" />
                </ScrollPane>

                <HBox fx:id="confirmationBox" visible="false" managed="false" spacing="15" alignment="CENTER_RIGHT" style="-fx-padding: 10 0 0 0;">
                    <Button fx:id="cancelBtn" text="Cancel" onAction="#handleCancel" styleClass="btn-cancel"/>
                    <Button fx:id="confirmBtn" text="Confirm Action" onAction="#handleConfirm" styleClass="btn-confirm"/>
                </HBox>
            </VBox>
            
            <Button text="â† New Search" onAction="#resetView" styleClass="btn-back"/>
            <Region prefHeight="80" />
        </VBox>
    </VBox>

    <HBox fx:id="searchContainer" alignment="CENTER_LEFT" maxWidth="750" minHeight="60" maxHeight="60" styleClass="search-pill-glass" pickOnBounds="false">
        <padding><Insets bottom="5" left="18" right="10" top="5"/></padding>
        
        <Button styleClass="btn-icon-glass">
            <graphic><SVGPath content="M12 5V19M5 12H19" stroke="#6b7280" strokeWidth="2" fill="transparent" scaleX="1.2" scaleY="1.2"/></graphic>
        </Button>
        
        <TextArea fx:id="userInput" promptText="Ask anything..." HBox.hgrow="ALWAYS" wrapText="true" styleClass="search-area"/>
        
        <HBox alignment="CENTER" spacing="10">
            <Button fx:id="micButton" styleClass="btn-mic-glass" onAction="#handleMicToggle">
                <graphic>
                    <SVGPath fx:id="micIcon" content="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 2.34 9 5v6c0 1.66 1.34 3 3 3z M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" 
                             fill="#6b7280" scaleX="0.9" scaleY="0.9"/>
                </graphic>
            </Button>

            <Button fx:id="sendButton" styleClass="btn-send-gradient" onAction="#handleSendMessage">
                <graphic><SVGPath content="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" fill="white" scaleX="0.9" scaleY="0.9" translateX="-1"/></graphic>
            </Button>
        </HBox>
    </HBox>

    <VBox fx:id="vocalOverlay" visible="false" managed="false" alignment="CENTER" spacing="30" styleClass="vocal-overlay">
        <Label text="I'm listening..." styleClass="vocal-status-text" fx:id="vocalStatusLabel"/>
        
        <StackPane>
            <Circle fx:id="vocalPulseCircle" radius="60" styleClass="vocal-pulse-circle"/>
            <SVGPath content="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 2.34 9 5v6c0 1.66 1.34 3 3 3z M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" 
                     fill="white" scaleX="2.5" scaleY="2.5"/>
        </StackPane>

        <Button text="Stop Listening" onAction="#handleMicToggle" styleClass="btn-vocal-stop"/>
    </VBox>

</StackPane>